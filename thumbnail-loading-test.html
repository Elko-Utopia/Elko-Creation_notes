<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¼©ç•¥å›¾åŠ è½½æ£€æŸ¥æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
      line-height: 1.6;
    }
    
    .test-section {
      margin: 2rem 0;
      padding: 1.5rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #f9f9f9;
    }
    
    .md-content.pswp-featured img {
      max-width: 250px;
      height: 180px;
      object-fit: cover;
      margin: 1rem;
      border-radius: 8px;
      border: 2px solid #ccc;
      transition: all 0.3s ease;
    }
    
    .image-info {
      font-size: 0.9em;
      color: #666;
      margin-top: 0.5rem;
    }
    
    button {
      padding: 0.5rem 1rem;
      margin: 0.25rem;
      border: none;
      border-radius: 4px;
      background: #007acc;
      color: white;
      cursor: pointer;
      font-size: 0.9em;
    }
    
    button:hover {
      background: #005a9e;
    }
    
    .status {
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 6px;
      border-left: 4px solid #007acc;
      background: #f0f8ff;
    }
    
    .warning {
      border-left-color: #ff9800;
      background: #fff8e1;
    }
    
    .error {
      border-left-color: #f44336;
      background: #ffebee;
    }
  </style>
</head>
<body>
  <h1>ğŸ–¼ï¸ ç¼©ç•¥å›¾åŠ è½½æ£€æŸ¥æµ‹è¯•</h1>
  
  <div class="status">
    <strong>æµ‹è¯•è¯´æ˜ï¼š</strong>
    <ul>
      <li>âœ… å·²åŠ è½½å›¾ç‰‡ - å…‰æ ‡ä¸ºpointerï¼Œå¯æ­£å¸¸ç‚¹å‡»æ‰“å¼€ç¯ç®±</li>
      <li>â³ åŠ è½½ä¸­å›¾ç‰‡ - å…‰æ ‡ä¸ºwaitï¼Œç‚¹å‡»ä¼šè¢«é˜»æ­¢å¹¶æ˜¾ç¤ºè­¦å‘Š</li>
      <li>âŒ åŠ è½½å¤±è´¥å›¾ç‰‡ - å…‰æ ‡ä¸ºnot-allowedï¼Œç‚¹å‡»è¢«é˜»æ­¢</li>
    </ul>
  </div>

  <div class="test-section">
    <h2>æ§åˆ¶æŒ‰é’®</h2>
    <button onclick="enableMonitor()">å¯ç”¨å®Œæ•´ç›‘æ§</button>
    <button onclick="testLoadingImages()">æµ‹è¯•æ…¢åŠ è½½å›¾ç‰‡</button>
    <button onclick="testBrokenImages()">æµ‹è¯•æŸåå›¾ç‰‡</button>
    <button onclick="resetImages()">é‡ç½®å›¾ç‰‡</button>
    <button onclick="showImageStatus()">æ˜¾ç¤ºå›¾ç‰‡çŠ¶æ€</button>
  </div>

  <div class="test-section">
    <h2>æ­£å¸¸å›¾ç‰‡ (åº”è¯¥å¯ä»¥ç‚¹å‡»)</h2>
    <div class="md-content pswp-featured" id="normal-images">
      <div>
        <img src="/Creation_notes/portfolio1.jpg" 
             data-full="/Creation_notes/portfolio1.jpg" 
             alt="æ­£å¸¸å›¾ç‰‡1">
        <div class="image-info">çŠ¶æ€: <span id="status-normal-1">æ£€æŸ¥ä¸­...</span></div>
      </div>
      <div>
        <img src="/Creation_notes/portfolio2.jpg" 
             data-full="/Creation_notes/portfolio2.jpg" 
             alt="æ­£å¸¸å›¾ç‰‡2">
        <div class="image-info">çŠ¶æ€: <span id="status-normal-2">æ£€æŸ¥ä¸­...</span></div>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h2>æ…¢åŠ è½½å›¾ç‰‡æµ‹è¯• (æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ)</h2>
    <div class="md-content pswp-featured" id="slow-images">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <div class="test-section">
    <h2>æŸåå›¾ç‰‡æµ‹è¯• (ä¸å­˜åœ¨çš„URL)</h2>
    <div class="md-content pswp-featured" id="broken-images">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <div class="test-section">
    <h2>å®æ—¶çŠ¶æ€ç›‘æ§</h2>
    <div id="live-status"></div>
  </div>

  <!-- å¼•å…¥è„šæœ¬ -->
  <script src="/Creation_notes/scripts/lightbox.js"></script>
  <script src="/Creation_notes/scripts/lightbox-monitor.js"></script>
  
  <script>
    function enableMonitor() {
      LightboxMonitor.enableFull();
      updateStatus('ç›‘æ§å·²å¯ç”¨ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯');
    }
    
    function testLoadingImages() {
      const container = document.getElementById('slow-images');
      container.innerHTML = `
        <div>
          <img src="https://picsum.photos/400/300?random=1&delay=3000" 
               data-full="https://picsum.photos/800/600?random=1" 
               alt="æ…¢åŠ è½½å›¾ç‰‡1">
          <div class="image-info">çŠ¶æ€: <span id="status-slow-1">åŠ è½½ä¸­...</span></div>
        </div>
        <div>
          <img src="https://picsum.photos/400/300?random=2&delay=5000" 
               data-full="https://picsum.photos/800/600?random=2" 
               alt="æ…¢åŠ è½½å›¾ç‰‡2">
          <div class="image-info">çŠ¶æ€: <span id="status-slow-2">åŠ è½½ä¸­...</span></div>
        </div>
      `;
      
      // é‡æ–°åˆå§‹åŒ–lightbox
      setTimeout(() => {
        if (typeof window.initLightboxAuto === 'function') {
          window.initLightboxAuto();
        }
      }, 100);
      
      updateStatus('å·²æ·»åŠ æ…¢åŠ è½½å›¾ç‰‡ï¼Œå°è¯•ç‚¹å‡»æŸ¥çœ‹é˜»æ­¢æ•ˆæœ');
    }
    
    function testBrokenImages() {
      const container = document.getElementById('broken-images');
      container.innerHTML = `
        <div>
          <img src="/nonexistent-image-1.jpg" 
               data-full="/nonexistent-image-1-full.jpg" 
               alt="æŸåå›¾ç‰‡1">
          <div class="image-info">çŠ¶æ€: <span id="status-broken-1">åŠ è½½å¤±è´¥</span></div>
        </div>
        <div>
          <img src="/nonexistent-image-2.jpg" 
               data-full="/nonexistent-image-2-full.jpg" 
               alt="æŸåå›¾ç‰‡2">
          <div class="image-info">çŠ¶æ€: <span id="status-broken-2">åŠ è½½å¤±è´¥</span></div>
        </div>
      `;
      
      // é‡æ–°åˆå§‹åŒ–lightbox
      setTimeout(() => {
        if (typeof window.initLightboxAuto === 'function') {
          window.initLightboxAuto();
        }
      }, 100);
      
      updateStatus('å·²æ·»åŠ æŸåå›¾ç‰‡ï¼Œç‚¹å‡»åº”è¯¥è¢«é˜»æ­¢');
    }
    
    function resetImages() {
      document.getElementById('slow-images').innerHTML = '';
      document.getElementById('broken-images').innerHTML = '';
      updateStatus('å·²é‡ç½®æµ‹è¯•å›¾ç‰‡');
    }
    
    function showImageStatus() {
      const images = document.querySelectorAll('.md-content.pswp-featured img');
      let statusHTML = '<h3>å›¾ç‰‡çŠ¶æ€è¯¦æƒ…:</h3><ul>';
      
      images.forEach((img, index) => {
        const loaded = img.complete && img.naturalWidth > 0;
        const failed = img.complete && img.naturalWidth === 0;
        const loading = !img.complete;
        
        let status = '';
        if (loaded) status = 'âœ… å·²åŠ è½½';
        else if (failed) status = 'âŒ åŠ è½½å¤±è´¥';
        else if (loading) status = 'â³ åŠ è½½ä¸­';
        
        statusHTML += `
          <li>
            <strong>å›¾ç‰‡ ${index + 1}:</strong> ${status}<br>
            <small>
              src: ${img.src}<br>
              complete: ${img.complete}, 
              naturalWidth: ${img.naturalWidth}, 
              naturalHeight: ${img.naturalHeight}<br>
              cursor: ${getComputedStyle(img).cursor}
            </small>
          </li>
        `;
      });
      
      statusHTML += '</ul>';
      document.getElementById('live-status').innerHTML = statusHTML;
    }
    
    function updateStatus(message) {
      console.log('ğŸ“¢', message);
    }
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ç”¨ç›‘æ§...');
      LightboxMonitor.enableFull();
      
      // ç­‰å¾…å›¾ç‰‡å’Œè„šæœ¬åŠ è½½
      setTimeout(() => {
        if (typeof window.initLightboxAuto === 'function') {
          window.initLightboxAuto();
        }
        
        // å®šæœŸæ›´æ–°çŠ¶æ€
        setInterval(showImageStatus, 2000);
        showImageStatus();
      }, 100);
      
      updateStatus('æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œç›‘æ§å·²å¯ç”¨');
    });
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼Œç”¨äºæµ‹è¯•é˜»æ­¢è¡Œä¸º
    document.addEventListener('click', function(e) {
      if (e.target.tagName === 'IMG' && e.target.closest('.md-content.pswp-featured')) {
        console.log('ğŸ–±ï¸ å›¾ç‰‡ç‚¹å‡»äº‹ä»¶:', {
          src: e.target.src,
          complete: e.target.complete,
          naturalWidth: e.target.naturalWidth,
          naturalHeight: e.target.naturalHeight,
          cursor: getComputedStyle(e.target).cursor
        });
      }
    });
  </script>
</body>
</html>